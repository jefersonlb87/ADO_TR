<!DOCTYPE html>
<html>
<body>
<script>
var currentDateGeral = currentDate();
//var currentDateGeral = retornaData("26/07/2022");
var posicao;
var datas = arraySprints();
var qtdDias;
var totalHoras;

function currentDate(){
	var today = new Date();
	var dd = String(today.getDate()).padStart(2, '0');
	var mm = String(today.getMonth()).padStart(2, '0'); //January is 0!
	var yyyy = today.getFullYear();
	var newDate = new Date(yyyy,mm,dd,0,0,1,0);
	//today = dd + '/' + mm + '/' + yyyy;
	//document.write("currentDateFucniton: " + newDate.getTime() + "<br />");
	return newDate;
}

function retornaData(dataCompleta) {
	var dd = dataCompleta.substring(0,2).padStart(2, '0');
	var mm = dataCompleta.substring(3,5).padStart(2, '0');
	var yyyy = dataCompleta.substring(6,10);
	var dataFormatada = new Date(yyyy, mm-1, dd,0,0,1,0);
	
	//document.write("retornaDataFunction: " + dataFormatada.getTime() + "<br />");
	return dataFormatada;
}

function myFunction() {
    document.getElementById("horas").innerHTML = "&emsp;&emsp;&emsp;&emsp;&emsp;" + retornaTotalHoras();
}

function arraySprints() {
	//padrão         Data_Ini,    Data_Fim,    Dias_Uteis
	var sprints = [
		["13/12/2022","26/12/2022","8"],
		["27/12/2022","09/01/2023","8"],
		["10/01/2023","23/01/2023","8"],
		["24/01/2023","06/02/2023","8"],
		["07/02/2023","20/02/2023","8"],
		["21/02/2023","06/03/2023","8"],
		["07/03/2023","20/03/2023","8"]
		];
	return sprints;
}

function encontraPosicaoArray() {
	for(let lin=0 ; lin<datas.length; lin++){
		if (currentDateGeral.getTime() >= retornaData(datas[lin][0]).getTime() && currentDateGeral.getTime() <= retornaData(datas[lin][1]).getTime() ){
			posicao = lin;
			//document.write("lin: "+lin + " data: " + retornaData(datas[lin][0]).getTime() + "<br />");
			//document.write("lin: "+lin + " current: " + currentDate().getTime() + "<br />");
			//document.write("posição é: " + posicao + "<br />");
		}
	}
}


function datediff(first, second) {
    // Take the difference between the dates and divide by milliseconds per day.
    // Round to nearest whole number to deal with DST.
    return Math.round((second-first)/(1000*60*60*24));
}

function quantidadeDias() {
	dias = datediff(retornaData(datas[posicao][0]), currentDateGeral);
	switch (dias) {
		case 0:
			qtdDias = dias + 1;
			break;
		case 1:
			qtdDias = dias + 1;
			break;
		case 2:
			qtdDias = dias + 1;
			break;
		case 3:
			qtdDias = dias + 1;
			break;
		case 4:
			qtdDias = dias;
			break;
		case 5:
			qtdDias = dias - 1;
			break;
		case 6:
			qtdDias = dias - 1;
			break;
		case 7:
			qtdDias = dias - 1;
			break;
		case 8:
			qtdDias = dias - 1;
			break;
		case 9:
			qtdDias = dias - 2;
			break;
		case 10:
			qtdDias = dias - 3;
			break;
		case 11:
			qtdDias = dias - 4;
			break;
		case 12:
			qtdDias = dias - 5;
			break;			
		case 13:
			qtdDias = dias - 6;
			break;			
		default:
		console.log("Desculpe, erro ao tentar achar o valor de {qtdDias}");
	}
}

function retornaTotalHoras(){
	totalHoras = 7 * qtdDias;
	return totalHoras;
}

function escreveValores(){
	document.write("Posição é: " + posicao + "<br />");
	document.write("CurrentDate é: " + currentDateGeral + "<br />");
	document.write("Data Sprint é: " + retornaData(datas[posicao][0]) + "<br />");
	document.write("Dias é: " + dias + "<br />");
	document.write("QtdDias é: " + qtdDias + "<br />");
	document.write("TotalHoras é: " + retornaTotalHoras() + "<br />");
}


</script>

<h2 style="color:blue;">HORAS ESPERADAS ATÉ AGORA</h2>
<H1 style="color:red" id="horas">VALOR</H1>

<script>
  encontraPosicaoArray();
  quantidadeDias();
  //escreveValores();
  //retornaData("24/03/2021");
  
  myFunction();
  
</script>

</body>
</html> 
